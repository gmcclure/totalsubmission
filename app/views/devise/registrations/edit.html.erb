<div class="tabbable">
  <ul class="nav nav-tabs">
    <li class="active"><a href="#profile-tab" data-toggle="tab">Your Profile</a></li>
    <li><a href="#publications-tab" data-toggle="tab">Manage Publications</a></li>
    <li><a href="#account-tab" data-toggle="tab">Account</a></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane active" id="profile-tab">
    <h2>Your Profile</h2>

    <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put, :role => 'form' }) do |f| %>
      <%= devise_error_messages! %>

      <div class="form-group"><%= f.label :email %><br />
      <%= f.email_field :email, :autofocus => true %></div>

      <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
        <div class="form-group">Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
      <% end %>

      <div class="form-group"><%= f.label :password %> <i>(leave blank if you don't want to change it)</i><br />
      <%= f.password_field :password, :autocomplete => "off" %></div>

      <div class="form-group"><%= f.label :password_confirmation %><br />
      <%= f.password_field :password_confirmation %></div>

      <div class="form-group"><%= f.label :current_password %> <i>(we need current password to confirm changes)</i><br />
      <%= f.password_field :current_password %></div>

      <div><%= f.submit "Update Profile" %></div>
    <% end %>
    </div>

    <div class="tab-pane" id="publications-tab">
    <% if current_user.publications.length > 0 %>
    <h3>Manage Publications</h3>
    <ul>
    <% current_user.publications.each do |pub| %>
      <li><%= link_to pub.title, edit_publication_path(pub.id) %> | <%= link_to 'Submissions', publication_submissions_path(pub.id) %></li>
    <% end %>
    </ul>
    <% end %>
    </div>

    <div class="tab-pane" id="account-tab">
    <h3>Cancel Account</h3>

    <p>Unhappy? <%= link_to "Cancel my account", registration_path(resource_name), :data => { :confirm => "Are you sure?" }, :method => :delete %>.</p>

    <%= link_to "Back", :back %>
    </div>
  </div>
</div>

<script>
  $(document).ready(function(){
    if (location.hash === '#publications-tab') {
      $('[href=' + '#publications-tab' + ']').tab('show');
    }
  });
</script>
